<runtime ram="32M" caps="1000" binary="init">

	<requires> <timer/> </requires>

	<fail after_seconds="20"/>
	<succeed>
		[test-ldso] Lib_2_global 0x11223343
		[test-ldso] Lib_1_global_1 0x5060707
		[test-ldso] Lib_1_global_2 0x1020303
		[test-ldso] lib_1_attr_constructor_2 0x4030200f
		[test-ldso] lib_1_attr_constructor_1 0x8070604f
		[test-ldso] Global_1 0x5060707
		[test-ldso] Global_2 0x1020303
		[test-ldso] attr_constructor_2 0x4030200f
		[test-ldso] attr_constructor_1 0x8070604f
		[test-ldso]
		[test-ldso] Dynamic-linker test
		[test-ldso] ===================
		[test-ldso]
		[test-ldso] Global objects and local static objects of program
		[test-ldso] --------------------------------------------------
		[test-ldso] global_1 0x5060706
		[test-ldso] global_2 0x1020302
		[test-ldso] Local_1 0x5060707f
		[test-ldso] local_1 0x5060707e
		[test-ldso] Local_2 0x1020303f
		[test-ldso] local_2 0x1020303e
		[test-ldso] pod_1 0x8070604e
		[test-ldso] pod_2 0x4030200e
		[test-ldso]
		[test-ldso] Access shared lib from program
		[test-ldso] ------------------------------
		[test-ldso] lib_2_global 0x11223342
		[test-ldso] Lib_1_local_3 0x12345677
		[test-ldso] lib_1_local_3 0x12345676
		[test-ldso] lib_1_pod_1 0x8070604d
		[test-ldso] Libc::read:
		[test-ldso] *Error: no plugin found for read(3)
		[test-ldso] Libc::abs(-10): 10
		[test-ldso]
		[test-ldso] Catch exceptions in program
		[test-ldso] ---------------------------
		[test-ldso] exception in program: caught
		[test-ldso] exception in shared lib: caught
		[test-ldso] exception in dynamic linker: caught
		[test-ldso]
		[test-ldso] global objects and local static objects of shared lib
		[test-ldso] -----------------------------------------------------
		[test-ldso] lib_1_global_1 0x5060706
		[test-ldso] lib_1_global_2 0x1020302
		[test-ldso] Lib_1_local_1 0x5060707f
		[test-ldso] lib_1_local_1 0x5060707e
		[test-ldso] Lib_1_local_2 0x1020303f
		[test-ldso] lib_1_local_2 0x1020303e
		[test-ldso] lib_1_pod_1 0x8070604e
		[test-ldso] lib_1_pod_2 0x4030200e
		[test-ldso]
		[test-ldso] Access shared lib from another shared lib
		[test-ldso] -----------------------------------------
		[test-ldso] lib_2_global 0x11223341
		[test-ldso] Lib_2_local 0x55667787
		[test-ldso] lib_2_local 0x55667786
		[test-ldso] lib_2_pod_1 0x87654320
		[test-ldso]
		[test-ldso] Catch exceptions in shared lib
		[test-ldso] ------------------------------
		[test-ldso] exception in lib: caught
		[test-ldso] exception in another shared lib: caught
		[test-ldso]
		[test-ldso] Test stack alignment
		[test-ldso] --------------------
		[test-ldso] &lt;warning: unsupported format string argument>
		[test-ldso] &lt;warning: unsupported format string argument>
		[test-ldso] &lt;warning: unsupported format string argument>
		[test-ldso] &lt;warning: unsupported format string argument>
		[test-ldso]
		[test-ldso] Dynamic cast
		[test-ldso] ------------
		[test-ldso] 'Object' called: good
		[test-ldso]
		[test-ldso] Shared-object API
		[test-ldso] -----------------
		[test-ldso] Global object constructed
		[test-ldso]
		[test-ldso] Destruction
		[test-ldso] -----------
		[test-ldso] ~Lib_2_local 0x55667785
		[test-ldso] ~Lib_1_local_2 0x1020303d
		[test-ldso] ~Lib_1_local_1 0x5060707d
		[test-ldso] ~Lib_1_local_3 0x12345675
		[test-ldso] ~Local_2 0x1020303d
		[test-ldso] ~Local_1 0x5060707d
		[test-ldso] ~Global_2 0x1020301
		[test-ldso] ~Global_1 0x5060705
		[test-ldso] ~Lib_1_global_2 0x1020301
		[test-ldso] ~Lib_1_global_1 0x5060705
		[test-ldso] ~Lib_2_global 0x11223340
		[test-ldso] attr_destructor_2 0x4030200d
		[test-ldso] attr_destructor_1 0x8070604c
		child "test-ldso" exited with exit value 123
	</succeed>

	<content>
		<rom label="ld.lib.so"/>
		<rom label="test-ldso_lib_1.lib.so"/>
		<rom label="test-ldso_lib_2.lib.so"/>
		<rom label="test-ldso_lib_dl.lib.so"/>
		<rom label="libc.lib.so"/>
		<rom label="libm.lib.so"/>
		<rom label="vfs.lib.so"/>
		<rom label="test-ldso"/>
	</content>

	<config>
		<parent-provides>
			<service name="ROM"/>
			<service name="CPU"/>
			<service name="LOG"/>
			<service name="PD"/>
		</parent-provides>
		<default-route>
			<any-service> <parent/> </any-service>
		</default-route>
		<default caps="100"/>
		<start name="test-ldso" ram="3M">
			<config ld_bind_now="no" ld_verbose="no">
				<vfs> <dir name="dev"> <log/> </dir> </vfs>
				<libc stdout="/dev/log"/>
			</config>
		</start>
	</config>
</runtime>
